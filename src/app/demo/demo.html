<section id="demo" class="demo">
  <div class="tabs">
    <button [class.active]="mode() === 'text'" (click)="setMode('text')">Text</button>
    <button [class.active]="mode() === 'pdf'" (click)="setMode('pdf')">PDF</button>
  </div>

  <div class="panel" *ngIf="mode() === 'text'">
    <textarea [ngModel]="inputText()" (ngModelChange)="inputText.set($event)" placeholder="Paste your research paragraph here..." rows="8"></textarea>
    <button class="button primary" (click)="runTextAnalysis()" [disabled]="loading()">{{ loading() ? 'Analyzingâ€¦' : 'Run Demo Analysis' }}</button>
  </div>

  <div class="panel" *ngIf="mode() === 'pdf'">
    <!-- Login button when not authenticated -->
    <div class="login-section" *ngIf="!isAuthenticated()">
      <div class="login-card">
        <img src="/Google__G__logo.svg.png" alt="Google" class="google-logo">
        <h3>Sign in to Continue</h3>
        <p>Sign in with your Google account to upload and manage your PDF files securely.</p>
        <button class="button google-button" (click)="login()">
          <img src="/Google__G__logo.svg.png" alt="Google" class="button-logo">
          <span>Sign in with Google</span>
        </button>
      </div>
    </div>

    <!-- File upload when authenticated -->
    <div class="upload-section" *ngIf="isAuthenticated()">
      <input id="pdfFile" class="file-input" type="file" accept=".pdf" (change)="onFileSelected($event)">
      <label class="button primary file-label" for="pdfFile">
        <span class="file-icon">ðŸ“„</span>
        <span>Choose PDF</span>
      </label>
      <span class="file-name" *ngIf="selectedFile() as f">{{ f.name }}</span>

      <div class="progress" *ngIf="loading()">
        <div class="bar" [style.width.%]="uploadProgress()"></div>
      </div>
      <button class="button primary" (click)="runPdfUpload()" [disabled]="!selectedFile() || loading()">
        {{ loading() ? 'Uploadingâ€¦' : 'Upload PDF' }}
      </button>
      
      <p class="upload-info">You can upload up to 3 PDF files (max 10MB each).</p>
    </div>

    <!-- File list when authenticated -->
    <div class="file-list" *ngIf="isAuthenticated() && userFiles().length > 0">
      <h3>Your Files</h3>
      <div class="file-item" *ngFor="let file of userFiles()">
        <span class="file-info">
          <span class="file-icon">ðŸ“„</span>
          <span>{{ file.fileName }}</span>
        </span>
        <div class="file-actions">
          <button class="button secondary small" (click)="downloadFile(file.fileName)">Download</button>
          <button class="button danger small" (click)="deleteFile(file.fileName)">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="error" *ngIf="error()">{{ error() }}</div>

  <div class="results" *ngIf="results() as r">
    <div class="cards">
      <div class="card" *ngFor="let res of r.responses">
        <div class="card-title">{{ res.agentName }}</div>
        <div class="card-body" [innerHTML]="renderMarkdown(res.analysis)"></div>
      </div>
    </div>
  </div>
</section>
